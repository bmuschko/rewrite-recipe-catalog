package com.yourorg.security;

import org.junit.jupiter.api.Test;
import org.openrewrite.test.RewriteTest;

import static org.openrewrite.gradle.Assertions.buildGradle;
import static org.openrewrite.gradle.toolingapi.Assertions.withToolingApi;
import static org.openrewrite.java.Assertions.java;
import static org.openrewrite.java.dependencies.DependencyVulnerabilityCheckBase.UpgradeDelta.minor;

public class SupplementedDependencyVulnerabilityCheckTest implements RewriteTest {
    @Test
    void fixesVulnerableDependenciesDeclaredInBaseAndSupplementalCVEs() {
        rewriteRun(
          spec -> spec.beforeRecipe(withToolingApi())
            .recipe(new SupplementedDependencyVulnerabilityCheck(null, false, minor)),
          //language=groovy
          buildGradle(
            """
              plugins { id 'java' }
              repositories { mavenCentral() }
              dependencies {
                  implementation 'com.fasterxml.jackson.core:jackson-databind:2.7.0'
                  implementation 'commons-lang:commons-lang:2.5'
              }
              """,
            """
              plugins { id 'java' }
              repositories { mavenCentral() }
              dependencies {
                  implementation 'com.fasterxml.jackson.core:jackson-databind:2.12.7.1'
                  implementation 'commons-lang:commons-lang:2.6'
              }
              """
          ),
          java("public class A {}")
        );
    }
}
